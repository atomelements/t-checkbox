<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-behaviors/paper-inky-focus-behavior.html">

<!--
`t-checkbox` is a button that can be either checked or unchecked.  User
can tap the checkbox to check or uncheck it.  Usually you use checkboxes
to allow user to select multiple options from a set.  If you have a single
ON/OFF option, avoid using a single checkbox and use `paper-toggle-button`
instead.

Example:

    <t-checkbox>label</t-checkbox>

    <t-checkbox checked> label</t-checkbox>
### Styling
  
  * {
    /* Unhecked state colors. */
    --t-checkbox-unchecked-color: #5a5a5a;
    --t-checkbox-unchecked-ink-color: #5a5a5a;

    /* Checked state colors. */
    --t-checkbox-checked-color: #009688;
    --t-checkbox-checked-ink-color: #009688;
  }
-->
<dom-module id="t-checkbox">
  <!-- <link rel="import" type="css" href="t-checkbox.css"> -->
<template>
<style include="iron-flex"></style>
<style>
  
:host {
  display: inline-block;
  white-space: nowrap;
  font-family: var(--primary-font-family);
}

:host(:focus) {
  outline: none;
}

.hidden {
  display: none;
}

#checkboxContainer {
  display: inline-block;
  position: relative;
  width: 18px;
  height: 18px;
  cursor: pointer;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  vertical-align: middle;
}

:host #checkbox {
  position: relative;
  box-sizing: border-box;
  height: 100%;
  border: solid 2px;
  border-color: var(--checkbox-unchecked-color, #777);
  border-radius: 2px;
  pointer-events: none;
  -webkit-transition: background-color 140ms, border-color 140ms;
  transition: background-color 140ms, border-color 140ms;
  background: var(--checkbox-unchecked-bg, #fff);
}

/* checkbox checked animations */
#checkbox.checked #checkmark {
  -webkit-animation: checkmark-expand 140ms ease-out forwards;
  animation: checkmark-expand 140ms ease-out forwards;
}

@-webkit-keyframes checkmark-expand {
  0% {
    top: 9px;
    left: 6px;
    width: 0px;
    height: 0px;
  }
  100% {
    top: -1px;
    left: 4px;
    width: 5px;
    height: 10px;
  }
}

@keyframes checkmark-expand {
  0% {
    top: 9px;
    left: 6px;
    width: 0px;
    height: 0px;
  }
  100% {
    top: -1px;
    left: 4px;
    width: 5px;
    height: 10px;
  }
}

:host #checkbox.checked {
  background-color: var(--checkbox-checked-color, #07c5f2);
  border-color: var(--checkbox-checked-color, #07c5f2);
}

:host #checkmark {
  -webkit-transform: rotate(45deg);
  transform: rotate(45deg);
  position: absolute;
  top: -1px;
  left: 4px;
  width: 5px;
  height: 10px;
  border-style: solid;
  border-top: none;
  border-left: none;
  border-right-width: 2px;
  border-bottom-width: 2px;
  border-color: var(--checkbox-check-sign-color, #ffffff);
}

/* label */
#checkboxLabel {
  position: relative;
  display: inline-block;
  vertical-align: middle;
  padding-left: var(--checkbox-label-padding-left, 8px);
  white-space: normal;
  pointer-events: none;
  font-size:var(--checkbox-item-text-size, 14px);
  color:var(--checkbox-item-text-color, #777777);
}

#checkboxLabel[hidden] {
  display: none;
}

/* disabled state */
:host([disabled]) {
  pointer-events: none;
}

:host([disabled]) #checkbox {
  opacity: 0.33;
  border-color: var(--checkbox-unchecked-color, #777777);
}

:host([disabled][checked]) #checkbox {
  background-color: var(--checkbox-unchecked-color, #777777);
}
:host([checkbox-right]) #checkboxLabel {
  padding-left: 0;
  padding-right: 8px;
}
:host([checkbox-right]) #checkboxContainer {
  order:2;
}

/* TODO: Hack. Use iron behaviors to remove ripples */
paper-ripple {
  color: rgba(0, 0, 0, 0) !important;
}


/* its moved to theme-map.html

:host {
    --checkbox-unchecked-color: var(--primary-text-color);
    --checkbox-unchecked-ink-color: var(--primary-text-color);

    --checkbox-checked-color: var(--default-primary-color);
    --checkbox-checked-ink-color: var(--default-primary-color);
  } */
</style>

  	<div class="layout horizontal center">
      <div id="checkboxContainer">
        <div id="checkbox" class$="[[_computeCheckboxClass(checked)]]">
          <div id="checkmark" class$="[[_computeCheckmarkClass(checked)]]"></div>
        </div>
      </div>

      <div id="checkboxLabel" class="flex" aria-hidden="true">
      	<slot></slot>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 't-checkbox',

    behaviors: [
      // TODO: Paper behaviors add ripple. Remove them if we don't want ripples
      Polymer.PaperInkyFocusBehavior
    ],

    hostAttributes: {
      role: 'checkbox',
      'aria-checked': false,
      tabindex: 0
    },

    properties: {
      
      /**
       * Put the checkmark on the right.
       *
       * @attribute checked
       * @type boolean
       * @default false
       */
       checkboxRight:{
        type:Boolean,
        value:false,
        reflectToAttribute:true
       },

       /**
       * Gets or sets the state, `true` is checked and `false` is unchecked.
       *
       * @attribute checked
       * @type boolean
       * @default false
       */
      checked: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        notify: true,
        observer: '_checkedChanged'
      },

      /**
       * If true, the button toggles the active state with each tap or press
       * of the spacebar.
       *
       * @attribute toggles
       * @type boolean
       * @default true
       */
      toggles: {
        type: Boolean,
        value: true,
        reflectToAttribute: true
      }
    },

    ready: function() {
      if (Polymer.dom(this).textContent == '') {
          this.$.checkboxLabel.hidden = true;
        } else {
          this.setAttribute('aria-label', Polymer.dom(this).textContent);
        }
        this._isReady = true;
    },

    // button-behavior hook
    _buttonStateChanged: function() {
      if (this.disabled) {
          return;
        }
        if (this._isReady) {
          this.checked = this.active;
        }
    },

    _checkedChanged: function(checked) {
      this.setAttribute('aria-checked', this.checked ? 'true' : 'false');
      this.active = this.checked;
      this.fire('checked-change');
    },

    _computeCheckboxClass: function(checked) {
      if (checked) {
        return 'checked';
      }
    },

    _computeCheckmarkClass: function(checked) {
      if (!checked) {
        return 'hidden';
      }
    }
  })
</script>
